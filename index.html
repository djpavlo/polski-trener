<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Polski Trener ‚Äî –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ A1‚ÄìB1</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Segoe UI', 'Helvetica Neue', sans-serif; background: linear-gradient(135deg, #fafaf6 0%, #f0ede4 100%); color: #2d2d2d; }
  #root { min-height: 100vh; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useCallback } = React;

const TOPICS = [
  {
    id: "conjugation", icon: "üîÑ", title: "–°–ø—Ä—è–∂–µ–Ω–∏–µ –≥–ª–∞–≥–æ–ª–æ–≤", color: "#2d6a4f",
    cards: [
      { q: "pracowaƒá ‚Üí Ola i Daniel ... (oni)", a: "pracujƒÖ", hint: "-ujƒÖ (I —Å–ø—Ä—è–∂–µ–Ω–∏–µ)" },
      { q: "chodziƒá ‚Üí Czƒôsto ... po g√≥rach (ja)", a: "chodzƒô", hint: "-ƒô (II —Å–ø—Ä—è–∂–µ–Ω–∏–µ)" },
      { q: "zamawiaƒá ‚Üí Oni ... jedzenie (oni)", a: "zamawiajƒÖ", hint: "-ajƒÖ" },
      { q: "wiedzieƒá ‚Üí Oni nie ... jak doj≈õƒá (oni)", a: "wiedzƒÖ", hint: "–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≥–ª–∞–≥–æ–ª" },
      { q: "mieƒá ‚Üí 80% Polak√≥w ... zwierzƒô (oni)", a: "ma", hint: "80% + –µ–¥.—á–∏—Å–ª–æ –≥–ª–∞–≥–æ–ª–∞" },
    ]
  },
  {
    id: "znac_wiedziec", icon: "üß†", title: "znaƒá vs wiedzieƒá", color: "#7b2cbf",
    cards: [
      { q: "Julia ... jƒôzyk hiszpa≈Ñski.\n(a) zna  (b) wie", a: "zna", hint: "znaƒá + —Å—É—â. (—á—Ç–æ-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ)" },
      { q: "Oni nie ..., jak doj≈õƒá do parku.\n(a) znajƒÖ  (b) wiedzƒÖ", a: "wiedzƒÖ", hint: "wiedzieƒá + –ø—Ä–∏–¥–∞—Ç–æ—á–Ω–æ–µ (jak/≈ºe/co)" },
      { q: "... pan tƒô restauracjƒô?\n(a) Zna  (b) Wie", a: "Zna", hint: "–∑–Ω–∞—Ç—å –∫–æ–≥–æ/—á—Ç–æ ‚Üí znaƒá" },
      { q: "Nie ..., o kt√≥rej zaczyna siƒô film.\n(a) znam  (b) wiem", a: "wiem", hint: "–∑–Ω–∞—Ç—å (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é) ‚Üí wiedzieƒá" },
    ]
  },
  {
    id: "narzednik", icon: "üîß", title: "–¢–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π (Narzƒôdnik)", color: "#e36414",
    cards: [
      { q: "M√≥j brat jest ... ... (poczƒÖtkujƒÖcy programista)", a: "poczƒÖtkujƒÖcym programistƒÖ", hint: "byƒá + Narzƒôdnik" },
      { q: "Do pracy jadƒô ... (hulajnoga)", a: "hulajnogƒÖ", hint: "-a ‚Üí -ƒÖ" },
      { q: "Latte z ... ... (mleko ro≈õlinne)", a: "mlekiem ro≈õlinnym", hint: "z + Narzƒôdnik, -o ‚Üí -em, -e ‚Üí -ym" },
      { q: "Je≈∫dziliby≈õcie ... (tramwaj)", a: "tramwajem", hint: "—Å—Ä–µ–¥—Å—Ç–≤–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ = Narzƒôdnik" },
    ]
  },
  {
    id: "dopelniacz", icon: "üìâ", title: "–†–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π (Dope≈Çniacz)", color: "#d62828",
    cards: [
      { q: "Nie lubiƒô ... ... (mocna kawa)", a: "mocnej kawy", hint: "nie + lubiƒá + Dope≈Çniacz" },
      { q: "brakiem ... na bilety (pieniƒÖdze)", a: "pieniƒôdzy", hint: "–ú–Ω.—á. Dope≈Çniacz" },
      { q: "Od ... po≈ºyczy≈Çe≈õ? (kto)", a: "kogo", hint: "od + Dope≈Çniacz" },
      { q: "Z powodu ... (choroba)", a: "choroby", hint: "z powodu + Dope≈Çniacz" },
      { q: "Dzisiaj nie ma ... ... (troje student√≥w)", a: "trojga student√≥w", hint: "troje ‚Üí trojga –≤ Dope≈Çniacz" },
    ]
  },
  {
    id: "miejscownik", icon: "üìç", title: "–ú–µ—Å—Ç–Ω—ã–π (Miejscownik)", color: "#0077b6",
    cards: [
      { q: "Mieszkamy w ... (Szwecja)", a: "Szwecji", hint: "-ja ‚Üí -ji" },
      { q: "By≈Çam w ... ... (nowa kawiarnia)", a: "nowej kawiarni", hint: "-a ‚Üí -ej, -ia ‚Üí -i" },
      { q: "Parki w moim ... (miasto)", a: "mie≈õcie", hint: "-o ‚Üí -≈õcie (—á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ)" },
      { q: "Spotkaniu o ... ... (08:30)", a: "√≥smej trzydzie≈õci", hint: "o + –ø–æ—Ä—è–¥–∫–æ–≤–æ–µ —á–∏—Å–ª–∏—Ç. –≤ Miejscownik" },
    ]
  },
  {
    id: "celownik", icon: "üéØ", title: "–î–∞—Ç–µ–ª—å–Ω—ã–π (Celownik)", color: "#4361ee",
    cards: [
      { q: "Sara napisa≈Ça ... (ja) co siƒô wydarzy≈Ço", a: "mi", hint: "–Ω–∞–ø–∏—Å–∞–ª–∞ –∫–æ–º—É? ‚Üí mi" },
      { q: "Ufam moim ... (przyjaciel, –º–Ω.—á.)", a: "przyjacio≈Çom", hint: "Celownik –º–Ω.—á. -om" },
      { q: "≈öwiat by≈Ç przeciwko ... (ty)", a: "tobie", hint: "przeciwko + Celownik" },
    ]
  },
  {
    id: "past_tense", icon: "‚è™", title: "–ü—Ä–æ—à–µ–¥—à–µ–µ –≤—Ä–µ–º—è", color: "#6a040f",
    cards: [
      { q: "Wczoraj dzieci ... bajki (oglƒÖdaƒá)", a: "oglƒÖda≈Çy", hint: "dzieci = niemƒôskoosobowe ‚Üí -≈Çy" },
      { q: "Moi dziadkowie ... siƒô w 1965\n(a) pobrali  (b) o≈ºenili  (c) wyszli za mƒÖ≈º", a: "pobrali", hint: "–ø–∞—Ä–∞ ‚Üí pobraƒá siƒô" },
      { q: "Na czele urzƒôdu ... Julia Nowak (stanƒÖƒá)", a: "stanƒô≈Ça", hint: "–æ–Ω–∞ ‚Üí -ƒô≈Ça" },
      { q: "Od kiedy ... nowy most (zbudowaƒá)", a: "zbudowano", hint: "–±–µ–∑–ª–∏—á–Ω–∞—è —Ñ–æ—Ä–º–∞ ‚Üí -no/-to" },
    ]
  },
  {
    id: "conditional", icon: "üí≠", title: "–£—Å–ª–æ–≤–Ω–æ–µ + ≈ºeby", color: "#457b9d",
    cards: [
      { q: "Gdyby≈õcie mieli kartƒô, ... tramwajem (je≈∫dziƒá, wy)", a: "je≈∫dziliby≈õcie", hint: "–ø—Ä–æ—à.–≤—Ä. + by≈õcie" },
      { q: "Proszƒô, ≈ºeby≈õ ... ze mnƒÖ (p√≥j≈õƒá, ty)", a: "poszed≈Ç/posz≈Ça", hint: "≈ºeby≈õ + –ø—Ä–æ—à.–≤—Ä." },
      { q: "Chcia≈Çby, ... (my) czƒô≈õciej spotykali siƒô (≈ºeby)", a: "≈ºeby≈õmy", hint: "≈ºeby + ≈õmy ‚Üí ≈ºeby≈õmy" },
    ]
  },
  {
    id: "ktory", icon: "üîó", title: "–ö–æ—Ç–æ—Ä—ã–π (kt√≥ry)", color: "#52796f",
    cards: [
      { q: "Ludzie, ... jedzƒÖ zdrowo (kt√≥ry, –ª–∏—á.-–º—É–∂. –º–Ω.)", a: "kt√≥rzy", hint: "–ª–∏—á–Ω–æ-–º—É–∂—Å–∫–∞—è —Ñ–æ—Ä–º–∞ –º–Ω.—á." },
      { q: "Osoby, ... tego nie robiƒÖ (kt√≥ry, –∂–µ–Ω. –º–Ω.)", a: "kt√≥re", hint: "–Ω–µ–º—É–∂—Å–∫–∞—è —Ñ–æ—Ä–º–∞ –º–Ω.—á." },
      { q: "Mƒô≈ºczyzna, ... tu mieszka (kt√≥ry)", a: "kt√≥ry", hint: "–º—É–∂. –µ–¥.—á. –∏–º–µ–Ω–∏—Ç–µ–ª—å–Ω—ã–π" },
    ]
  },
  {
    id: "comparison", icon: "‚öñÔ∏è", title: "–°—Ç–µ–ø–µ–Ω–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è", color: "#bc6c25",
    cards: [
      { q: "Amazonka jest ... rzekƒÖ ni≈º Wis≈Ça (d≈Çugi, —Å—Ä–∞–≤–Ω–∏—Ç.)", a: "d≈Çu≈ºszƒÖ", hint: "d≈Çugi ‚Üí d≈Çu≈ºszy, + Narzƒôdnik ‚Üí d≈Çu≈ºszƒÖ" },
      { q: "Piotr gra ... z ca≈Çej grupy (dobrze, –ø—Ä–µ–≤–æ—Å—Ö.)", a: "najlepiej", hint: "dobrze ‚Üí lepiej ‚Üí najlepiej" },
      { q: "Jej koledzy sƒÖ bardzo ... (mi≈Çy, –º–Ω. –ª–∏—á.-–º—É–∂.)", a: "mili", hint: "mi≈Çy ‚Üí mili (–ª–∏—á–Ω–æ-–º—É–∂—Å–∫–∞—è)" },
    ]
  },
  {
    id: "numbers", icon: "üî¢", title: "–ß–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ", color: "#6d6875",
    cards: [
      { q: "74 ‚àí 23 = ? (—Å–ª–æ–≤–∞–º–∏)", a: "piƒôƒádziesiƒÖt jeden", hint: "50 + 1" },
      { q: "1956 –≥–æ–¥ (w ... roku)", a: "tysiƒÖc dziewiƒôƒáset piƒôƒádziesiƒÖtym sz√≥stym", hint: "Miejscownik –ø–æ—Ä—è–¥–∫–æ–≤–æ–≥–æ" },
      { q: "MajƒÖ ... dzieci (3, —Å–æ–±–∏—Ä–∞—Ç.)", a: "troje", hint: "–¥–µ—Ç–∏ ‚Üí —Å–æ–±–∏—Ä–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–∏—Ç." },
      { q: "Film dozwolony od ... (12 lat)", a: "dwunastu lat", hint: "od + Dope≈Çniacz" },
    ]
  },
  {
    id: "idioms", icon: "üí¨", title: "–ò–¥–∏–æ–º—ã –∏ –ª–µ–∫—Å–∏–∫–∞", color: "#5a189a",
    cards: [
      { q: "Kasia ma ≈õwietne pomys≈Çy ‚Äî ma ...\n(a) g≈Çowƒô na karku  (b) pstro w g≈Çowie", a: "g≈Çowƒô na karku", hint: "= —Å–º–µ–∫–∞–ª–∏—Å—Ç–∞—è, —Å –≥–æ–ª–æ–≤–æ–π" },
      { q: "Zarabia ma≈Ço. Pracuje ...\n(a) za p√≥≈Ç darmo  (b) na czarno  (c) jak szalony", a: "za p√≥≈Ç darmo", hint: "–º–∞–ª–æ = –ø–æ—á—Ç–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ" },
      { q: "Ma 15 kg ...\n(a) nadwagi  (b) wagi  (c) przewagi", a: "nadwagi", hint: "–ª–∏—à–Ω–∏–π –≤–µ—Å = nadwaga" },
      { q: "Wysy≈Çam serdeczne ... z wakacji\n(a) witania  (b) pozdrowienia  (c) ≈ºyczenia", a: "pozdrowienia", hint: "–ø—Ä–∏–≤–µ—Ç—ã —Å –æ—Ç–¥—ã—Ö–∞" },
      { q: "Niczego siƒô nie ...\n(a) przerobi≈Ç  (b) dorobi≈Ç  (c) zrobi≈Ç", a: "dorobi≈Ç", hint: "dorobiƒá siƒô = –Ω–∞–∂–∏—Ç—å, –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å" },
      { q: "Lena ma ... zdaƒá egzamin (nadzieja)", a: "nadziejƒô", hint: "mieƒá nadziejƒô = –Ω–∞–¥–µ—è—Ç—å—Å—è" },
    ]
  },
  {
    id: "po_zdaniu", icon: "‚è≠Ô∏è", title: "po + –æ—Ç–≥–ª–∞–≥–æ–ª—å–Ω–æ–µ —Å—É—â.", color: "#3a5a40",
    cards: [
      { q: "Zaczniemy wakacje po ... egzamin√≥w (zdaƒá)", a: "zdaniu", hint: "po + Miejscownik –æ—Ç zdanie" },
      { q: "Przyszed≈Ç sp√≥≈∫niony, ale ... (uczesaƒá siƒô)", a: "uczesany", hint: "–ø—Ä–∏—á–∞—Å—Ç–∏–µ = —Å–æ—Å—Ç–æ—è–Ω–∏–µ" },
      { q: "Ona m√≥wi, ≈ºe to przez ... (on)", a: "niego", hint: "przez + Biernik (–ø–æ—Å–ª–µ –ø—Ä–µ–¥–ª–æ–≥–∞ ‚Üí niego)" },
    ]
  },
];

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function ProgressRing({ pct, size = 44, stroke = 4, color }) {
  const r = (size - stroke) / 2;
  const c = 2 * Math.PI * r;
  return (
    <svg width={size} height={size} style={{ transform: "rotate(-90deg)" }}>
      <circle cx={size/2} cy={size/2} r={r} fill="none" stroke="rgba(0,0,0,0.08)" strokeWidth={stroke} />
      <circle cx={size/2} cy={size/2} r={r} fill="none" stroke={color} strokeWidth={stroke}
        strokeDasharray={c} strokeDashoffset={c * (1 - pct)} strokeLinecap="round"
        style={{ transition: "stroke-dashoffset 0.5s ease" }} />
    </svg>
  );
}

function App() {
  const [mode, setMode] = useState("menu");
  const [topicId, setTopicId] = useState(null);
  const [cardIdx, setCardIdx] = useState(0);
  const [flipped, setFlipped] = useState(false);
  const [showHint, setShowHint] = useState(false);
  const [quizCards, setQuizCards] = useState([]);
  const [userAnswer, setUserAnswer] = useState("");
  const [quizResult, setQuizResult] = useState(null);
  const [score, setScore] = useState({ correct: 0, wrong: 0, answers: [] });
  const [topicScores, setTopicScores] = useState(() => {
    try { return JSON.parse(localStorage.getItem("polskiScores") || "{}"); } catch { return {}; }
  });
  const [allTopicsMode, setAllTopicsMode] = useState(false);

  useEffect(() => {
    try { localStorage.setItem("polskiScores", JSON.stringify(topicScores)); } catch {}
  }, [topicScores]);

  const topic = TOPICS.find(t => t.id === topicId);
  const cards = topic?.cards || [];

  const startLearn = (id) => { setTopicId(id); setCardIdx(0); setFlipped(false); setShowHint(false); setMode("learn"); setAllTopicsMode(false); };
  const startQuiz = (id) => { const t = TOPICS.find(t => t.id === id); setTopicId(id); setQuizCards(shuffle(t.cards)); setCardIdx(0); setUserAnswer(""); setQuizResult(null); setScore({ correct: 0, wrong: 0, answers: [] }); setMode("quiz"); setAllTopicsMode(false); };
  const startAllQuiz = () => { const all = TOPICS.flatMap(t => t.cards.map(c => ({ ...c, topicId: t.id, topicTitle: t.title }))); setQuizCards(shuffle(all).slice(0, 20)); setTopicId(null); setCardIdx(0); setUserAnswer(""); setQuizResult(null); setScore({ correct: 0, wrong: 0, answers: [] }); setMode("quiz"); setAllTopicsMode(true); };

  const checkAnswer = () => {
    const card = quizCards[cardIdx];
    const correct = userAnswer.trim().toLowerCase() === card.a.toLowerCase() || card.a.toLowerCase().split("/").some(v => userAnswer.trim().toLowerCase() === v.trim());
    setQuizResult(correct ? "correct" : "wrong");
    setScore(s => ({ correct: s.correct + (correct ? 1 : 0), wrong: s.wrong + (correct ? 0 : 1), answers: [...s.answers, { card, userAnswer: userAnswer.trim(), correct }] }));
  };

  const nextQuizCard = () => {
    if (cardIdx + 1 >= quizCards.length) {
      const pct = Math.round((score.correct / quizCards.length) * 100);
      if (topicId) setTopicScores(s => ({ ...s, [topicId]: Math.max(s[topicId] || 0, pct) }));
      setMode("results");
    } else { setCardIdx(i => i + 1); setUserAnswer(""); setQuizResult(null); setShowHint(false); }
  };

  const handleKeyDown = useCallback((e) => {
    if (mode === "quiz" && e.key === "Enter") { if (quizResult) nextQuizCard(); else if (userAnswer.trim()) checkAnswer(); }
    if (mode === "learn") {
      if (e.key === " " || e.key === "Enter") { e.preventDefault(); setFlipped(f => !f); }
      if (e.key === "ArrowRight" && cardIdx < cards.length - 1) { setCardIdx(i => i + 1); setFlipped(false); setShowHint(false); }
      if (e.key === "ArrowLeft" && cardIdx > 0) { setCardIdx(i => i - 1); setFlipped(false); setShowHint(false); }
    }
  }, [mode, quizResult, userAnswer, cardIdx, cards.length]);

  useEffect(() => { window.addEventListener("keydown", handleKeyDown); return () => window.removeEventListener("keydown", handleKeyDown); }, [handleKeyDown]);

  const S = { container: { minHeight: "100vh", padding: 20 } };

  // ‚îÄ‚îÄ MENU ‚îÄ‚îÄ
  if (mode === "menu") return (
    <div style={S.container}>
      <div style={{ maxWidth: 720, margin: "0 auto" }}>
        <div style={{ textAlign: "center", marginBottom: 32 }}>
          <div style={{ fontSize: 42, fontWeight: 800, letterSpacing: -1, color: "#1a1a1a", marginBottom: 4 }}>üáµüá± Polski Trener</div>
          <div style={{ fontSize: 15, color: "#888", letterSpacing: 2, textTransform: "uppercase" }}>–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ A1‚ÄìB1 ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ –∫–≤–∏–∑</div>
        </div>
        <button onClick={startAllQuiz} style={{ width: "100%", padding: "16px 24px", marginBottom: 28, background: "linear-gradient(135deg, #2d6a4f, #40916c)", color: "#fff", border: "none", borderRadius: 14, cursor: "pointer", fontSize: 17, fontWeight: 700, boxShadow: "0 4px 20px rgba(45,106,79,0.3)" }}>
          üé≤ –°–ª—É—á–∞–π–Ω—ã–π –∫–≤–∏–∑ ‚Äî 20 –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ –≤—Å–µ—Ö —Ç–µ–º
        </button>
        <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fill, minmax(300px, 1fr))", gap: 12 }}>
          {TOPICS.map(t => {
            const best = topicScores[t.id];
            return (
              <div key={t.id} style={{ background: "#fff", borderRadius: 14, padding: "16px 18px", boxShadow: "0 2px 12px rgba(0,0,0,0.06)", border: `2px solid ${best >= 80 ? "#c8e6c9" : best >= 50 ? "#fff3e0" : "transparent"}` }}>
                <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 10 }}>
                  <div><span style={{ fontSize: 20, marginRight: 8 }}>{t.icon}</span><span style={{ fontWeight: 700, fontSize: 14, color: t.color }}>{t.title}</span></div>
                  {best !== undefined && <div style={{ position: "relative", display: "flex", alignItems: "center", justifyContent: "center" }}><ProgressRing pct={best/100} color={best >= 80 ? "#4caf50" : best >= 50 ? "#ff9800" : "#e53935"} /><span style={{ position: "absolute", fontSize: 11, fontWeight: 700, color: "#555" }}>{best}%</span></div>}
                </div>
                <div style={{ fontSize: 12, color: "#999", marginBottom: 12 }}>{t.cards.length} –∫–∞—Ä—Ç–æ—á–µ–∫</div>
                <div style={{ display: "flex", gap: 8 }}>
                  <button onClick={() => startLearn(t.id)} style={{ flex: 1, padding: "8px 0", border: `1.5px solid ${t.color}`, background: "transparent", color: t.color, borderRadius: 8, cursor: "pointer", fontWeight: 600, fontSize: 13 }}>üìñ –£—á–∏—Ç—å</button>
                  <button onClick={() => startQuiz(t.id)} style={{ flex: 1, padding: "8px 0", border: "none", background: t.color, color: "#fff", borderRadius: 8, cursor: "pointer", fontWeight: 600, fontSize: 13 }}>‚úèÔ∏è –ö–≤–∏–∑</button>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );

  // ‚îÄ‚îÄ LEARN ‚îÄ‚îÄ
  if (mode === "learn") {
    const card = cards[cardIdx]; const color = topic.color;
    return (
      <div style={S.container}>
        <div style={{ maxWidth: 560, margin: "0 auto" }}>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 20 }}>
            <button onClick={() => setMode("menu")} style={{ background: "none", border: "none", cursor: "pointer", fontSize: 15, color: "#888", fontWeight: 600 }}>‚Üê –ù–∞–∑–∞–¥</button>
            <span style={{ fontSize: 14, color: "#aaa" }}>{cardIdx + 1} / {cards.length}</span>
          </div>
          <div style={{ textAlign: "center", marginBottom: 8 }}><span style={{ fontSize: 28 }}>{topic.icon}</span><span style={{ fontSize: 18, fontWeight: 700, color, marginLeft: 10 }}>{topic.title}</span></div>
          <div style={{ height: 4, background: "#e0e0e0", borderRadius: 2, marginBottom: 28 }}><div style={{ height: 4, background: color, borderRadius: 2, width: `${((cardIdx+1)/cards.length)*100}%`, transition: "width 0.3s" }} /></div>
          <div onClick={() => setFlipped(f => !f)} style={{ background: flipped ? color : "#fff", color: flipped ? "#fff" : "#2d2d2d", borderRadius: 20, padding: "48px 36px", minHeight: 220, display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center", cursor: "pointer", boxShadow: "0 8px 40px rgba(0,0,0,0.1)", transition: "all 0.35s ease" }}>
            {!flipped ? (<><div style={{ fontSize: 20, fontWeight: 600, lineHeight: 1.6, textAlign: "center", whiteSpace: "pre-line" }}>{card.q}</div><div style={{ marginTop: 20, fontSize: 13, color: "#bbb" }}>–ù–∞–∂–º–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –æ—Ç–≤–µ—Ç</div></>) : (<><div style={{ fontSize: 13, opacity: 0.7, marginBottom: 10, textTransform: "uppercase", letterSpacing: 1 }}>–û—Ç–≤–µ—Ç</div><div style={{ fontSize: 28, fontWeight: 800, textAlign: "center" }}>{card.a}</div><div style={{ fontSize: 14, opacity: 0.8, marginTop: 16, textAlign: "center", fontStyle: "italic" }}>{card.hint}</div></>)}
          </div>
          {!flipped && <div style={{ textAlign: "center", marginTop: 16 }}><button onClick={e => { e.stopPropagation(); setShowHint(h => !h); }} style={{ background: "none", border: "none", cursor: "pointer", fontSize: 13, color: "#aaa" }}>{showHint ? `üí° ${card.hint}` : "üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞"}</button></div>}
          <div style={{ display: "flex", justifyContent: "center", gap: 16, marginTop: 28 }}>
            <button disabled={cardIdx === 0} onClick={() => { setCardIdx(i => i - 1); setFlipped(false); setShowHint(false); }} style={{ padding: "12px 28px", borderRadius: 10, border: "1.5px solid #ddd", background: "#fff", cursor: cardIdx === 0 ? "default" : "pointer", opacity: cardIdx === 0 ? 0.4 : 1, fontWeight: 600, fontSize: 15 }}>‚óÄ –ù–∞–∑–∞–¥</button>
            <button disabled={cardIdx === cards.length - 1} onClick={() => { setCardIdx(i => i + 1); setFlipped(false); setShowHint(false); }} style={{ padding: "12px 28px", borderRadius: 10, border: "none", background: color, color: "#fff", cursor: cardIdx === cards.length - 1 ? "default" : "pointer", opacity: cardIdx === cards.length - 1 ? 0.4 : 1, fontWeight: 600, fontSize: 15 }}>–î–∞–ª–µ–µ ‚ñ∂</button>
          </div>
          <div style={{ textAlign: "center", marginTop: 20, fontSize: 12, color: "#bbb" }}>–ü—Ä–æ–±–µ–ª ‚Äî –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å ¬∑ ‚Üê ‚Üí ‚Äî –Ω–∞–≤–∏–≥–∞—Ü–∏—è</div>
        </div>
      </div>
    );
  }

  // ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ
  if (mode === "quiz") {
    const card = quizCards[cardIdx]; const color = allTopicsMode ? "#2d6a4f" : topic.color;
    const isMultiChoice = card.q.includes("(a)") || card.q.includes("(b)");
    const options = isMultiChoice ? card.q.split("\n").slice(1).join(" ").match(/\(([a-c])\)\s*([^(]+)/g)?.map(m => { const match = m.match(/\(([a-c])\)\s*(.+)/); return match ? { letter: match[1], text: match[2].trim() } : null; }).filter(Boolean) : [];

    return (
      <div style={S.container}>
        <div style={{ maxWidth: 560, margin: "0 auto" }}>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 20 }}>
            <button onClick={() => setMode("menu")} style={{ background: "none", border: "none", cursor: "pointer", fontSize: 15, color: "#888", fontWeight: 600 }}>‚Üê –í—ã–π—Ç–∏</button>
            <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
              <span style={{ fontSize: 14, color: "#4caf50", fontWeight: 700 }}>‚úì {score.correct}</span>
              <span style={{ fontSize: 14, color: "#e53935", fontWeight: 700 }}>‚úó {score.wrong}</span>
              <span style={{ fontSize: 14, color: "#aaa" }}>{cardIdx + 1}/{quizCards.length}</span>
            </div>
          </div>
          <div style={{ height: 4, background: "#e0e0e0", borderRadius: 2, marginBottom: 28 }}><div style={{ height: 4, background: color, borderRadius: 2, width: `${((cardIdx+1)/quizCards.length)*100}%`, transition: "width 0.3s" }} /></div>
          {allTopicsMode && card.topicTitle && <div style={{ textAlign: "center", marginBottom: 8, fontSize: 12, color: "#999", letterSpacing: 1, textTransform: "uppercase" }}>{card.topicTitle}</div>}
          <div style={{ background: "#fff", borderRadius: 20, padding: "36px 32px", boxShadow: "0 8px 40px rgba(0,0,0,0.08)", marginBottom: 24, borderTop: `4px solid ${color}` }}>
            <div style={{ fontSize: 19, fontWeight: 600, lineHeight: 1.6, marginBottom: 24, whiteSpace: "pre-line" }}>{isMultiChoice ? card.q.split("\n")[0] : card.q}</div>
            {isMultiChoice ? (
              <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
                {options.map(opt => {
                  const isCorrect = opt.text.trim().toLowerCase() === card.a.toLowerCase();
                  const isSelected = userAnswer === opt.text.trim();
                  let bg = "#f8f8f8", border = "2px solid #e8e8e8";
                  if (quizResult) { if (isCorrect) { bg = "#e8f5e9"; border = "2px solid #4caf50"; } else if (isSelected && !isCorrect) { bg = "#ffebee"; border = "2px solid #e53935"; } } else if (isSelected) { bg = "#e3f2fd"; border = `2px solid ${color}`; }
                  return (<button key={opt.letter} disabled={!!quizResult} onClick={() => setUserAnswer(opt.text.trim())} style={{ padding: "14px 18px", borderRadius: 12, border, background: bg, cursor: quizResult ? "default" : "pointer", textAlign: "left", fontSize: 16, fontWeight: 500, transition: "all 0.15s", display: "flex", alignItems: "center", gap: 12 }}>
                    <span style={{ width: 28, height: 28, borderRadius: "50%", display: "flex", alignItems: "center", justifyContent: "center", background: isSelected ? color : "#e0e0e0", color: isSelected ? "#fff" : "#999", fontSize: 13, fontWeight: 700, flexShrink: 0 }}>{opt.letter}</span>{opt.text.trim()}
                  </button>);
                })}
              </div>
            ) : (
              <input value={userAnswer} onChange={e => setUserAnswer(e.target.value)} disabled={!!quizResult} placeholder="–í–≤–µ–¥–∏ –æ—Ç–≤–µ—Ç..." autoFocus style={{ width: "100%", padding: "14px 18px", fontSize: 18, borderRadius: 12, border: `2px solid ${quizResult === "correct" ? "#4caf50" : quizResult === "wrong" ? "#e53935" : "#e0e0e0"}`, outline: "none", background: quizResult === "correct" ? "#e8f5e9" : quizResult === "wrong" ? "#ffebee" : "#fafafa", transition: "all 0.2s", boxSizing: "border-box" }} />
            )}
            {quizResult === "wrong" && <div style={{ marginTop: 16, padding: "12px 16px", background: "#fff3e0", borderRadius: 10, fontSize: 15 }}>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: <strong>{card.a}</strong><div style={{ fontSize: 13, color: "#888", marginTop: 4 }}>{card.hint}</div></div>}
            {quizResult === "correct" && <div style={{ marginTop: 16, padding: "12px 16px", background: "#e8f5e9", borderRadius: 10, fontSize: 15, color: "#2e7d32" }}>‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ! <span style={{ fontSize: 13, color: "#888" }}>{card.hint}</span></div>}
            {!showHint && !quizResult && <button onClick={() => setShowHint(true)} style={{ marginTop: 12, background: "none", border: "none", cursor: "pointer", fontSize: 13, color: "#bbb" }}>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞</button>}
            {showHint && !quizResult && <div style={{ marginTop: 12, fontSize: 13, color: "#999", fontStyle: "italic" }}>üí° {card.hint}</div>}
          </div>
          <div style={{ display: "flex", justifyContent: "center" }}>
            {!quizResult ? (
              <button onClick={checkAnswer} disabled={!userAnswer.trim()} style={{ padding: "14px 48px", borderRadius: 12, border: "none", background: userAnswer.trim() ? color : "#ccc", color: "#fff", cursor: userAnswer.trim() ? "pointer" : "default", fontWeight: 700, fontSize: 16, boxShadow: userAnswer.trim() ? `0 4px 20px ${color}44` : "none" }}>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            ) : (
              <button onClick={nextQuizCard} style={{ padding: "14px 48px", borderRadius: 12, border: "none", background: color, color: "#fff", cursor: "pointer", fontWeight: 700, fontSize: 16, boxShadow: `0 4px 20px ${color}44` }}>{cardIdx + 1 >= quizCards.length ? "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã" : "–î–∞–ª–µ–µ ‚Üí"}</button>
            )}
          </div>
          <div style={{ textAlign: "center", marginTop: 14, fontSize: 12, color: "#ccc" }}>Enter ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å / –¥–∞–ª–µ–µ</div>
        </div>
      </div>
    );
  }

  // ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ
  if (mode === "results") {
    const total = score.correct + score.wrong;
    const pct = Math.round((score.correct / total) * 100);
    const emoji = pct >= 90 ? "üèÜ" : pct >= 70 ? "üëç" : pct >= 50 ? "üí™" : "üìö";
    const message = pct >= 90 ? "–û—Ç–ª–∏—á–Ω–æ!" : pct >= 70 ? "–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!" : pct >= 50 ? "–ù–µ–ø–ª–æ—Ö–æ, –Ω–æ –µ—Å—Ç—å –Ω–∞–¥ —á–µ–º –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å" : "–°—Ç–æ–∏—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —ç—Ç—É —Ç–µ–º—É";
    return (
      <div style={S.container}>
        <div style={{ maxWidth: 560, margin: "0 auto" }}>
          <div style={{ textAlign: "center", marginBottom: 32 }}>
            <div style={{ fontSize: 64, marginBottom: 8 }}>{emoji}</div>
            <div style={{ fontSize: 48, fontWeight: 800, color: pct >= 70 ? "#2d6a4f" : pct >= 50 ? "#e36414" : "#d62828" }}>{pct}%</div>
            <div style={{ fontSize: 18, fontWeight: 600, color: "#555", marginBottom: 4 }}>{message}</div>
            <div style={{ fontSize: 14, color: "#aaa" }}>{score.correct} –∏–∑ {total} –ø—Ä–∞–≤–∏–ª—å–Ω–æ</div>
          </div>
          {score.answers.filter(a => !a.correct).length > 0 && (
            <div style={{ marginBottom: 28 }}>
              <div style={{ fontSize: 15, fontWeight: 700, color: "#d62828", marginBottom: 12 }}>–û—à–∏–±–∫–∏ ‚Äî –ø–æ–≤—Ç–æ—Ä–∏:</div>
              {score.answers.filter(a => !a.correct).map((a, i) => (
                <div key={i} style={{ background: "#fff", borderRadius: 12, padding: "14px 18px", marginBottom: 8, borderLeft: "4px solid #e53935", boxShadow: "0 2px 8px rgba(0,0,0,0.04)" }}>
                  <div style={{ fontSize: 14, color: "#555", marginBottom: 6 }}>{a.card.q.split("\n")[0]}</div>
                  <div style={{ fontSize: 13 }}><span style={{ color: "#e53935", textDecoration: "line-through" }}>{a.userAnswer}</span><span style={{ margin: "0 8px", color: "#ccc" }}>‚Üí</span><span style={{ color: "#2e7d32", fontWeight: 700 }}>{a.card.a}</span></div>
                  <div style={{ fontSize: 12, color: "#aaa", marginTop: 4 }}>{a.card.hint}</div>
                </div>
              ))}
            </div>
          )}
          <div style={{ display: "flex", gap: 12 }}>
            <button onClick={() => setMode("menu")} style={{ flex: 1, padding: 14, borderRadius: 12, border: "2px solid #ddd", background: "#fff", cursor: "pointer", fontWeight: 700, fontSize: 15 }}>–ö —Ç–µ–º–∞–º</button>
            <button onClick={() => { if (allTopicsMode) startAllQuiz(); else startQuiz(topicId); }} style={{ flex: 1, padding: 14, borderRadius: 12, border: "none", background: "#2d6a4f", color: "#fff", cursor: "pointer", fontWeight: 700, fontSize: 15 }}>–ï—â—ë —Ä–∞–∑</button>
          </div>
        </div>
      </div>
    );
  }
  return null;
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
